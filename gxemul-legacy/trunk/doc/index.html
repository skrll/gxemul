<html>
<head><title>mips64emul documentation</title>
<meta name="robots" content="nofollow">
</head>
<body bgcolor=#ffffff text=#000000 link=#4040f0 vlink=#404040 alink=#ff0000>

<p>
<table width=100%>
  <tr><td width=100% bgcolor=#808070><font color=#ffffe0 size=6>
  <b>mips64emul</b></font></td></tr></table>

<p>
<table width=100%>
  <tr><td width=100% bgcolor=#b0b0b0><font color=#8f2f2f size=4>
	Documentation
  </font></td></tr>
</table>

<ul>
  <li><a href="#overview">Overview</a>
  <li><a href="#build">How to compile/build the emulator</a>
  <li><a href="#use">How to use the emulator</a>
  <li><a href="#disk">How to start the emulator with a disk image</a>
  <li><a href="#userland">Running userland binaries</a>
  <li><a href="#feedback">Feedback</a>
</ul>


<p><br>
<a name="overview"></a>
<h4>Overview:</h4>

Sorry, there is almost no documentation for mips64emul at this point in time,
except for reading the <a href="../">source code</a> itself.


<p><br>
<a name="build"></a>
<h4>How to compile/build the emulator:</h4>

Uncompress the .tar.gz file, and run
<pre>
	$ <b>./configure</b>
	$ <b>make</b>
</pre>
This should work on any Unix-like system. If not, please report that as
a bug to me.


<p><br>
<a name="use"></a>
<h4>How to use the emulator:</h4>

The emulator contains code which tries to emulate the workings of MIPS-like CPUs
and surrounding hardware found in real machines, but no actual ROM code or program
code.  You will need some form of program to run in the emulator.  You can use
pre-compiled kernels (for example NetBSD or Linux), ROM images, or other programs
that are in MIPS binary format. A couple of different file formats are supported
(ELF, a.out, ECOFF, SREC, raw binaries).
<p>
As an example, let's say you want to emulate a Silicon Graphics O2 machine.
This machine type is also known as IP32, in the SGI namespace. Let's also
say that you want to run NetBSD on this emulated machine. A pre-compiled kernel
for NetBSD/sgimips can be found here: <a href="http://ftp.sunet.se/pub/NetBSD/NetBSD-1.6.1/sgimips/binary/kernel/netbsd-INSTALL.gz">netbsd-INSTALL.gz</a>
<p>
Once you have downloaded the kernel and gunzip'd it, you can try it out in the
emulator like this:
<pre>
	$ <b>./mips64emul -G32 -q netbsd-INSTALL</b>
</pre>
-G signifies that we want SGI emulation, and 32 is the SGI-specific machine type.
-q supresses debug messages. If everything works like it should, you should see NetBSD's boot messages...
<pre>
	$ <b>./mips64emul -G32 -q netbsd-INSTALL</b>
	zs channel 0 had address 0xbfbd9830
	 [ no symbols available ]
	CPU clock speed = 3.00Mhz
	Copyright (c) 1996, 1997, 1998, 1999, 2000, 2001, 2002
	    The NetBSD Foundation, Inc.  All rights reserved.
	Copyright (c) 1982, 1986, 1989, 1991, 1993
	    The Regents of the University of California.  All rights reserved.

	NetBSD 1.6.1 (RAMDISK) #0: Wed Apr  9 00:56:44 UTC 2003
	    autobuild@tgm.daemon.org:/autobuild/netbsd-1-6/sgimips/OBJ/autobuild/netbsd-1-6/src/sys/arch/sgimips/compile/RAMDISK
	32768 KB memory, 29988 KB free, 0 for ARCS, 1740 KB in 435 buffers
	mainbus0 (root): SGI-IP32 [SGI, 8], 1 processor
	cpu0 at mainbus0: MIPS R5000 CPU (0x2321) Rev. 2.1 with built-in FPU Rev. 2.1
	cpu0: 32KB/32B 2-way set-associative L1 Instruction cache, 48 TLB entries
	cpu0: 32KB/32B 2-way set-associative write-back L1 Data cache
	...
</pre>
... and after a while be able to interact with sysinst, NetBSD's install program.
<p>
To exit the emulator, type CTRL-C. By typing CTRL-B instead, a CTRL-C is sent to
the emulated program.
<p>
For some emulated machine types, a graphical framebuffer console is supported.
NetBSD/pmax (kernel found <a href="http://ftp.sunet.se/pub/NetBSD/NetBSD-1.6.1/pmax/binary/kernel/netbsd-INSTALL.gz">here</a>)
running on an emulated DECstation 5000 supports this:
<pre>
	$ <b>./mips64emul -D2 -X -Y2 -q -I500000 -M12 netbsd-INSTALL</b>
</pre>
-D2 stands for DECstation, type 2; -X means to use X-windows to get a graphical
framebuffer; -Y2 is used to scale down the window by a factor 2x2; -q supresses
debug output; -I500000 lets the emulated clock chip on DECstations have
a more realistic pace; and -M12 sets the amount of emulated memory to 12 MB.
The result should looks something like this:
<p>
<center>
<img src="netbsd-pmax-framebuffer.gif">
</center>


<p><br>
<a name="disk"></a>
<h4>How to start the emulator with a disk image:</h4>

Simply add <i>-d diskimagefilename</i> to the command line. For example, if you
want to run a NetBSD/pmax kernel on an emulated DECstation machine, you
would use a command line such as this:
<pre>
	$ <b>./mips64emul -D2 -q -d pmax_diskimage.fs netbsd-pmax-INSTALL</b>
</pre>
Only emulated machine types
that have a <b><i>working</i></b> SCSI or IDE controller support disk images.
DECstation type 2 (3MAX) has a SCSI controller, so we're lucky.
<p>
<font color=#f00000><b>NOTE: Disk images are not really supported yet.</b></font>
<p>
It is possible to have more than one disk. For each -d argument, a disk
image is added; the first will be SCSI target 0, the second will be target 1, and so on.
<pre>
	$ <b>./mips64emul -D2 -q -d disk0.raw -d disk1.raw -d disk2.raw netbsd-pmax-INSTALL</b>
</pre>


<p><br>
<a name="userland"></a>
<h4>Running userland binaries:</h4>

You can run (some) userland programs as well. This will not emulate any
particular machine, but instead try to translate syscalls from for example
NetBSD/pmax into the host's OS' syscalls. For example, running /bin/hostname
or /bin/date and similarly trivial programs from the NetBSD/pmax distribution
works:
<pre>
	$ <b>./mips64emul -qu1 pmax_bin_hostname</b>
	tab.csbnet.se
	$ <b>./mips64emul -qu1 pmax_bin_date</b>
	Sun Jan 25 02:26:14 GMT 2004
	$ <b>./mips64emul -qu1 pmax_bin_sleep</b>
	usage: pmax_bin_sleep seconds
	$ <b>./mips64emul -qu1 pmax_bin_sleep 5</b>
	$ <b>./mips64emul -qu1 pmax_bin_sync</b>
</pre>
There's also an Ultrix4 emulation mode:
<pre>
	$ <b>./mips64emul -qu2 ultrix4_bin_date</b>
	UNIMPLEMENTED ultrix syscall 54
	UNIMPLEMENTED ultrix syscall 62
	Mon Feb  9 12:50:59 WET 2004
	$ <b>./mips64emul -qu2 ultrix4_bin_hostname</b>
	tab.csbnet.se
</pre>
Userland syscall emulation is still in its beginning stages, so almost
nothing works.


<p><br>
<a name="feedback"></a>
<h4>Feedback:</h4>

If you have comments, don't hesitate to mail me at
md1gavan @mdstud.chalmers.se.


<hr>

</body>
</html>
